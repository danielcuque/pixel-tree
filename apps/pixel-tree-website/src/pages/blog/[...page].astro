---
import { getCollection } from "astro:content";
import { BlogGrid, BlogSidebar } from "../../components/blog";
import { PaginationButtons } from "../../components/blog/button";
import type { BlogSidebarItem } from "../../components/blog/sidebar";
import { blogTags } from "../../content/config";
import BlogLayout from "../../layouts/BlogLayout.astro";

export async function getStaticPaths({ paginate }: any) {
    const posts = await getCollection("blog");
    return paginate(posts, {
        pageSize: 6,
    });
}

const blogPosts = await getCollection("blog");

// Get all tags and their count
const items: BlogSidebarItem[] = blogTags.map((tag) => {
    const posts = blogPosts.filter((post) => post.data.tag.includes(tag));
    return {
        tag,
        count: posts.length,
        isSelected: false,
    };
});

const { page } = Astro.props;
---

<BlogLayout>
    <!-- TODO: SEO Props -->
    <BlogSidebar items={items} />
    <BlogGrid posts={page.data} />
    <!-- TODO: post pagination -->
    <PaginationButtons previous={page.url.prev} next={page.url.next} />
</BlogLayout>
